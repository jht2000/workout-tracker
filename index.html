<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0a0f">
  <title>Workout Tracker</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230a0a0f' width='100' height='100' rx='20'/><text y='70' x='50' text-anchor='middle' font-size='60'>&#x1F4AA;</text></svg>">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- Header -->
  <header id="app-header">
    <button id="btn-back" class="header-btn hidden" aria-label="Back">&larr;</button>
    <h1 id="header-title">Workout Tracker</h1>
    <button id="btn-settings" class="header-btn" aria-label="Settings">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    </button>
  </header>

  <!-- Screens -->
  <main id="app-main">

    <!-- Home: Day Selector -->
    <section id="screen-home" class="screen active">
      <div class="active-day-banner" id="active-day-banner">
        <span>No active workout selected</span>
      </div>
      <h2 class="section-title">Select Workout Day</h2>
      <div id="day-cards" class="day-cards"></div>
      <div class="home-actions">
        <button id="btn-library" class="btn btn-outline full-width">Exercise Library</button>
        <button id="btn-history" class="btn btn-outline full-width">Workout History</button>
      </div>
    </section>

    <!-- Day Workout View -->
    <section id="screen-day" class="screen">
      <div class="day-header">
        <h2 id="day-title"></h2>
        <p id="day-theme" class="subtitle"></p>
        <button id="btn-set-active" class="btn btn-primary">Set as Today's Workout</button>
      </div>
      <div class="day-tabs">
        <button class="tab active" data-tab="muscles">Muscle Groups</button>
        <button class="tab" data-tab="exercises">Exercises</button>
      </div>
      <div id="day-muscles-tab" class="tab-content active">
        <div id="day-muscles" class="muscle-list"></div>
      </div>
      <div id="day-exercises-tab" class="tab-content">
        <div id="day-exercises" class="exercise-groups"></div>
        <div id="day-secondary-exercises" class="exercise-groups"></div>
      </div>
      <button id="btn-add-exercise-day" class="fab" aria-label="Add Exercise">+</button>
    </section>

    <!-- Exercise Library -->
    <section id="screen-library" class="screen">
      <div class="search-bar">
        <input type="text" id="library-search" placeholder="Search exercises..." autocomplete="off">
      </div>
      <div id="library-filter-muscles" class="filter-chips"></div>
      <div id="library-list" class="exercise-list"></div>
      <button id="btn-add-exercise-lib" class="fab" aria-label="Add Exercise">+</button>
    </section>

    <!-- Add/Edit Exercise Form -->
    <section id="screen-exercise-form" class="screen">
      <h2 id="exercise-form-title">Add Exercise</h2>
      <form id="exercise-form" autocomplete="off">
        <input type="hidden" id="exercise-id">
        <div class="form-group">
          <label for="exercise-name">Exercise Name</label>
          <input type="text" id="exercise-name" required placeholder="e.g., Hammer Strength Chest Press">
        </div>
        <div class="form-group">
          <label>Primary Muscle Group(s)</label>
          <div id="primary-muscles-select" class="muscle-picker"></div>
        </div>
        <div class="form-group">
          <label>Secondary Muscle Group(s) <span class="optional">(optional)</span></label>
          <div id="secondary-muscles-select" class="muscle-picker"></div>
        </div>
        <div class="form-group">
          <label>Location(s)</label>
          <div id="location-picker" class="location-picker"></div>
          <div class="location-add-row">
            <input type="text" id="location-custom-input" placeholder="Add new location...">
            <button type="button" id="btn-add-location" class="btn btn-outline btn-small">Add</button>
          </div>
        </div>
        <div class="form-group">
          <label for="exercise-notes">Notes</label>
          <textarea id="exercise-notes" rows="3" placeholder="Seat settings, grip width, form cues..."></textarea>
        </div>
        <div id="exercise-day-match" class="day-match-indicator hidden"></div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary full-width">Save Exercise</button>
          <button type="button" id="btn-save-and-log" class="btn btn-accent full-width hidden">Save & Start Logging</button>
          <button type="button" id="btn-delete-exercise" class="btn btn-danger full-width hidden">Delete Exercise</button>
        </div>
      </form>
    </section>

    <!-- Exercise Detail / Set Logging -->
    <section id="screen-exercise-detail" class="screen">
      <div class="exercise-info">
        <h2 id="detail-name"></h2>
        <div id="detail-muscles" class="detail-muscles"></div>
        <div id="detail-location" class="detail-meta"></div>
        <button id="btn-edit-exercise" class="btn btn-outline btn-small">Edit</button>
      </div>
      <div class="notes-section">
        <h3>Notes</h3>
        <textarea id="detail-notes-input" class="inline-notes" rows="3" placeholder="Tap to add notes (seat settings, grip, form cues...)"></textarea>
      </div>
      <div class="log-section">
        <h3>Log Set</h3>
        <div class="set-input-row">
          <div class="set-input-group">
            <label for="input-weight">Weight</label>
            <input type="number" id="input-weight" inputmode="decimal" step="any" placeholder="0">
          </div>
          <div class="set-input-group">
            <label for="input-reps">Reps</label>
            <input type="number" id="input-reps" inputmode="numeric" placeholder="0">
          </div>
          <button id="btn-log-set" class="btn btn-primary btn-log">Log</button>
        </div>
      </div>
      <div class="history-section">
        <h3>Today's Sets</h3>
        <div id="today-sets" class="sets-table"></div>
      </div>
      <div class="history-section">
        <h3>Last Workout</h3>
        <div id="last-workout-sets" class="sets-table"></div>
      </div>
      <div class="history-section">
        <button id="btn-full-history" class="btn btn-outline full-width">View Full History</button>
      </div>
    </section>

    <!-- Full History for Exercise -->
    <section id="screen-history-exercise" class="screen">
      <h2 id="history-exercise-name"></h2>
      <div id="exercise-full-history" class="full-history"></div>
    </section>

    <!-- Workout History (all) -->
    <section id="screen-history" class="screen">
      <h2>Workout History</h2>
      <div id="workout-history-list" class="full-history"></div>
    </section>

    <!-- Settings -->
    <section id="screen-settings" class="screen">
      <h2>Settings</h2>
      <div class="form-group">
        <label for="sheets-url">Google Apps Script URL</label>
        <input type="url" id="sheets-url" placeholder="https://script.google.com/macros/s/...">
        <p class="help-text">Deploy the Apps Script and paste the web app URL here.</p>
      </div>
      <div class="form-actions">
        <button id="btn-save-sheets-url" class="btn btn-primary full-width">Save URL</button>
      </div>
      <div class="settings-sync">
        <p>Last sync: <span id="last-sync-time"></span></p>
        <button id="btn-sync-now" class="btn btn-outline full-width">Sync Now</button>
        <button id="btn-pull-sheets" class="btn btn-outline full-width">Pull from Sheets (overwrite local)</button>
        <button id="btn-push-sheets" class="btn btn-outline full-width">Push to Sheets (overwrite remote)</button>
      </div>
      <div class="settings-data">
        <h3>Data Management</h3>
        <button id="btn-export-json" class="btn btn-outline full-width">Export Data (JSON)</button>
        <button id="btn-import-json" class="btn btn-outline full-width">Import Data (JSON)</button>
        <input type="file" id="import-file" accept=".json" class="hidden">
        <button id="btn-clear-data" class="btn btn-danger full-width">Clear All Local Data</button>
      </div>
      <div class="settings-version">
        <span id="app-version"></span>
      </div>
    </section>

  </main>

  <!-- Toast notification -->
  <div id="toast" class="toast hidden"></div>

  <!-- Scripts -->
  <script src="js/data.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/sheets.js"></script>
  <script src="js/app.js"></script>

</body>
</html>
